#!/usr/bin/env php
<?php
require __DIR__ . '/vendor/autoload.php';

define('ROOT_PATH', realpath(__DIR__));
require_once __DIR__ . '/system/helpers/core_helper.php';

// Load Command Classes
use System\Framework\ControllersCommand;
use System\Framework\ModelsCommand;
use System\Framework\TableCommand;

// Get CLI arguments
$command = $argv[1] ?? null;
$subCommand = $argv[2] ?? null;

// Ensure a command is provided
if (!$command || !$subCommand) {
    echo "Usage: php framework <command> <name>\n";
    exit(1);
}

// Handle command input
switch ($command) {
    case 'controller':
        $controllerCommand = new ControllersCommand();
        $controllerCommand->create($subCommand);
        break;

    case 'model':
        $modelCommand = new ModelsCommand();
        $modelCommand->create($subCommand);
        break;

    case 'table':
        // Load database configuration
        $configdb = config('db'); 
        $dbConnection = loadDatabaseDriver($configdb['db_driver'], $configdb);
        
        // Initialize TableCommand
        $tableCommand = new TableCommand($dbConnection);
        $tableCommand->handle($subCommand);
        break;

    default:
        echo "Invalid command. Available commands: controller, model, table.\n";
        break;
}

/**
 * Load the database driver
 */
function loadDatabaseDriver($driver, $config) {
    $driverClass = '\\System\\Drivers\\Database\\' . ucfirst($driver) . 'Driver';
    if (class_exists($driverClass)) {
        return new $driverClass($config);
    } else {
        throw new \Exception("Database driver '{$driver}' not found.");
    }
}
